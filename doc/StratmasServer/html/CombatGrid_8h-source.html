<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Stratmas: CombatGrid.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>CombatGrid.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef STRATMAS_COMBAT_GRID_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define STRATMAS_COMBAT_GRID_H</span>
00003 <span class="preprocessor"></span>
00004 
00005 <span class="comment">// System</span>
00006 <span class="preprocessor">#include &lt;iosfwd&gt;</span>
00007 <span class="preprocessor">#include &lt;list&gt;</span>
00008 <span class="preprocessor">#include &lt;map&gt;</span>
00009 <span class="preprocessor">#include &lt;set&gt;</span>
00010 <span class="preprocessor">#include &lt;string&gt;</span>
00011 <span class="preprocessor">#include &lt;vector&gt;</span>
00012 
00013 <span class="comment">// Own</span>
00014 <span class="preprocessor">#include "BasicGrid.h"</span>
00015 <span class="preprocessor">#include "GridPos.h"</span>
00016 <span class="preprocessor">#include "PresenceObject.h"</span>
00017 <span class="preprocessor">#include "PresenceObjectAllocator.h"</span>
00018 <span class="preprocessor">#include "SOFactoryListener.h"</span>
00019 
00020 <span class="comment">// Forward Declarations</span>
00021 <span class="keyword">class </span><a class="code" href="classFaction.html">Faction</a>;
00022 <span class="keyword">class </span><a class="code" href="classGrid.html">Grid</a>;
00023 <span class="keyword">class </span><a class="code" href="classShape.html">Shape</a>;
00024 <span class="keyword">class </span><a class="code" href="classUnit.html">Unit</a>;
00025 
00026 
<a name="l00034"></a><a class="code" href="classCombatGrid.html">00034</a> <span class="keyword">class </span><a class="code" href="classCombatGrid.html">CombatGrid</a> : <span class="keyword">public</span> <a class="code" href="classBasicGrid.html">BasicGrid</a>, <a class="code" href="classSOFactoryListener.html">SOFactoryListener</a> {
00035 <span class="keyword">private</span>:
<a name="l00037"></a><a class="code" href="classCombatGrid.html#r0">00037</a>      std::map&lt;std::string, int&gt; <a class="code" href="classCombatGrid.html#r0">mNameToIndex</a>;
00038 
<a name="l00040"></a><a class="code" href="classCombatGrid.html#r1">00040</a>      std::vector&lt;std::string&gt; <a class="code" href="classCombatGrid.html#r1">mIndexToName</a>;
00041 
<a name="l00047"></a><a class="code" href="classCombatGrid.html#r2">00047</a>      <span class="keywordtype">bool</span> *<a class="code" href="classCombatGrid.html#r2">mResetableLayer</a>;
00048 
<a name="l00050"></a><a class="code" href="classCombatGrid.html#r3">00050</a>      <a class="code" href="classGrid.html">Grid</a>&amp; <a class="code" href="classCombatGrid.html#r3">mGrid</a>;
00051 
<a name="l00053"></a><a class="code" href="classCombatGrid.html#r4">00053</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#r4">mNumLayers</a>;
00054      
<a name="l00056"></a><a class="code" href="classCombatGrid.html#r5">00056</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#r5">mSumLayerIndex</a>;
00057 
<a name="l00059"></a><a class="code" href="classCombatGrid.html#r6">00059</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#r6">mCasualtySumLayerIndex</a>;
00060 
<a name="l00066"></a><a class="code" href="classCombatGrid.html#r7">00066</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#r7">mBlueLayerIndex</a>;
00067 
<a name="l00069"></a><a class="code" href="classCombatGrid.html#r8">00069</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#r8">mInsurgentLayerIndex</a>;
00070 
<a name="l00072"></a><a class="code" href="classCombatGrid.html#r9">00072</a>      std::vector&lt;Unit*&gt;&amp; <a class="code" href="classCombatGrid.html#r9">mForces</a>;
00073 
<a name="l00075"></a><a class="code" href="classCombatGrid.html#r10">00075</a>      <span class="keywordtype">double</span>** <a class="code" href="classCombatGrid.html#r10">mGridData</a>;
00076 
<a name="l00081"></a><a class="code" href="classCombatGrid.html#r11">00081</a>      std::set&lt;PresenceObject*, lessPresenceObjectPointer&gt; <a class="code" href="classCombatGrid.html#r11">mPresence</a>;
00082 
<a name="l00084"></a><a class="code" href="classCombatGrid.html#r12">00084</a>      <a class="code" href="classPresenceObjectAllocator.html">PresenceObjectAllocator</a> <a class="code" href="classCombatGrid.html#r12">mPOA</a>;
00085 
00086      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#d0">reset</a>(<span class="keywordtype">bool</span> includeNonResetables = <span class="keyword">false</span>);
00087      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#d1">unitToGrid</a>(<a class="code" href="classUnit.html">Unit</a>&amp; u);
00088      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#d3">markPresence</a>(<a class="code" href="classUnit.html">Unit</a>&amp; u);
00089      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#d3">markPresence</a>();
00090      
00091 <span class="keyword">public</span>:
00092      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* kCasualtyStr;
00093 
00094      <a class="code" href="classCombatGrid.html#a0">CombatGrid</a>(<a class="code" href="classMap.html">Map</a>&amp; amap, <a class="code" href="classGrid.html">Grid</a>&amp; grid, std::vector&lt;Unit*&gt;&amp; forceVec, <span class="keyword">const</span> std::vector&lt;Faction*&gt;&amp; facVec);
00095      <a class="code" href="classCombatGrid.html#a1">~CombatGrid</a>();
00096 
00097      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#a2">objectAdded</a>(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference</a>&amp; ref, int64_t initiator);
00098      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#a3">objectRemoved</a>(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference</a>&amp; ref, int64_t initiator);
00099 
<a name="l00105"></a><a class="code" href="classCombatGrid.html#a4">00105</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#a4">layers</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r4">mNumLayers</a>; }
00106 
<a name="l00112"></a><a class="code" href="classCombatGrid.html#a5">00112</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#a5">blueLayer</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r7">mBlueLayerIndex</a>; }
00113 
<a name="l00119"></a><a class="code" href="classCombatGrid.html#a6">00119</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#a6">casualtySumLayer</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r6">mCasualtySumLayerIndex</a>; }
00120 
<a name="l00128"></a><a class="code" href="classCombatGrid.html#a7">00128</a>      <span class="keywordtype">double</span> <a class="code" href="classCombatGrid.html#a7">value</a>(<span class="keywordtype">int</span> actInd, <span class="keywordtype">int</span> layer)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r10">mGridData</a>[layer][actInd]; }
00129 
<a name="l00137"></a><a class="code" href="classCombatGrid.html#a8">00137</a>      <span class="keywordtype">double</span> <a class="code" href="classCombatGrid.html#a7">value</a>(<span class="keywordtype">int</span> actInd, <span class="keyword">const</span> std::string&amp; layer)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r10">mGridData</a>[<a class="code" href="classCombatGrid.html#a19">nameToIndex</a>(layer)][actInd]; }
00138 
<a name="l00146"></a><a class="code" href="classCombatGrid.html#a9">00146</a>      <span class="keywordtype">double</span> <a class="code" href="classCombatGrid.html#a7">value</a>(<a class="code" href="classGridPos.html">GridPos</a> gp, <span class="keywordtype">int</span> layer)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r10">mGridData</a>[layer][<a class="code" href="classBasicGrid.html#a7">posToActive</a>(gp.<a class="code" href="classGridPos.html#o1">r</a>, gp.<a class="code" href="classGridPos.html#o0">c</a>)]; }
00147 
<a name="l00155"></a><a class="code" href="classCombatGrid.html#a10">00155</a>      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#a10">add</a>(<span class="keywordtype">int</span> actInd, <span class="keywordtype">int</span> layer, <span class="keywordtype">double</span> val)<span class="keyword"> const </span>{ <a class="code" href="classCombatGrid.html#r10">mGridData</a>[layer][actInd] += val; }
00156 
00157      <span class="keywordtype">double</span>* <a class="code" href="classCombatGrid.html#a11">aggregate</a>(<span class="keyword">const</span> std::list&lt;GridPos&gt;&amp; pos, <span class="keywordtype">double</span>*&amp; outAgg) <span class="keyword">const</span>;
00158      <span class="keywordtype">double</span>* <a class="code" href="classCombatGrid.html#a11">aggregate</a>(<span class="keyword">const</span> <a class="code" href="classShape.html">Shape</a>&amp; region, <span class="keywordtype">double</span>*&amp; outAgg) <span class="keyword">const</span>;
00159 
00160      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#d0">reset</a>(std::vector&lt;Unit*&gt;&amp; forceVec);
00161      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#a14">unitsToGrid</a>();
00162      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#a15">setUpBattleField</a>();
00163      <span class="keywordtype">void</span> <a class="code" href="classCombatGrid.html#a16">registerCombat</a>();
00164      
<a name="l00170"></a><a class="code" href="classCombatGrid.html#a17">00170</a>      <span class="keyword">const</span> std::map&lt;std::string, int&gt;&amp; <a class="code" href="classCombatGrid.html#a17">nameToIndexMap</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r0">mNameToIndex</a>; }
00171 
<a name="l00178"></a><a class="code" href="classCombatGrid.html#a18">00178</a>      std::string <a class="code" href="classCombatGrid.html#a18">indexToName</a>(<span class="keywordtype">int</span> i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCombatGrid.html#r1">mIndexToName</a>[i]; }
00179 
<a name="l00186"></a><a class="code" href="classCombatGrid.html#a19">00186</a>      <span class="keywordtype">int</span> <a class="code" href="classCombatGrid.html#a19">nameToIndex</a>(<span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const </span>{
00187           std::map&lt;std::string, int&gt;::const_iterator it = <a class="code" href="classCombatGrid.html#r0">mNameToIndex</a>.find(name);
00188           <span class="keywordflow">return</span> (it == <a class="code" href="classCombatGrid.html#r0">mNameToIndex</a>.end() ? -1 : it-&gt;second);
00189      }
00190 
00191      <span class="keyword">friend</span> std::ostream&amp; <a class="code" href="classCombatGrid.html#a4">operator &lt;&lt; </a>(std::ostream&amp; o, <span class="keyword">const</span> <a class="code" href="classCombatGrid.html">CombatGrid</a>&amp; c);
00192 };
00193 
00194 
00195 <span class="preprocessor">#endif   // STRATMAS_COMBAT_GRID_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jan 31 14:27:32 2007 for Stratmas by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
