<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Approxsim: TSQueue.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>TSQueue.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef _TSQUEUE_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _TSQUEUE_H</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include &lt;queue&gt;</span>
00005 <span class="preprocessor">#include &lt;boost/thread/condition.hpp&gt;</span>
00006 <span class="preprocessor">#include &lt;boost/thread/mutex.hpp&gt;</span>
00007 
<a name="l00018"></a><a class="code" href="classTSQueue.html">00018</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classTSQueue.html">TSQueue</a>
00019 {
00020 <span class="keyword">private</span>:
<a name="l00021"></a><a class="code" href="classTSQueue.html#r0">00021</a>      boost::mutex <a class="code" href="classTSQueue.html#r0">mLock</a>;   
<a name="l00022"></a><a class="code" href="classTSQueue.html#r1">00022</a>      boost::condition <a class="code" href="classTSQueue.html#r1">mEmpty</a>;   
<a name="l00023"></a><a class="code" href="classTSQueue.html#r2">00023</a>      std::queue&lt;T&gt; <a class="code" href="classTSQueue.html#r2">mQ</a>;        
00024 
00025 <span class="keyword">public</span>:
<a name="l00027"></a><a class="code" href="classTSQueue.html#a0">00027</a>      <a class="code" href="classTSQueue.html#a0">TSQueue</a>() { }
<a name="l00029"></a><a class="code" href="classTSQueue.html#a1">00029</a>      <a class="code" href="classTSQueue.html#a1">~TSQueue</a>() { }
00030      
00036      <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTSQueue.html#a2">enqueue</a>(T t);
00037 
00043      <span class="keyword">inline</span> T <a class="code" href="classTSQueue.html#a3">dequeue</a>();
00044 
<a name="l00050"></a><a class="code" href="classTSQueue.html#a4">00050</a>      <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classTSQueue.html#a4">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classTSQueue.html#r2">mQ</a>.size(); }
00051 };
00052 
00053 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00054"></a><a class="code" href="classTSQueue.html#a2">00054</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classTSQueue.html#a2">TSQueue&lt;T&gt;::enqueue</a>(T t)
00055 {
00056 
00057      boost::mutex::scoped_lock lk(<a class="code" href="classTSQueue.html#r0">mLock</a>);   <span class="comment">// Lock</span>
00058      <a class="code" href="classTSQueue.html#r2">mQ</a>.push(t);                            <span class="comment">// Enqueue</span>
00059      <span class="keywordflow">if</span> (<a class="code" href="classTSQueue.html#r2">mQ</a>.size() == 1) {                  <span class="comment">// If the queue was empty </span>
00060           <a class="code" href="classTSQueue.html#r1">mEmpty</a>.notify_one();              <span class="comment">// Notify a waiting thread</span>
00061      }
00062      lk.unlock();                           <span class="comment">// Unlock by lk's</span>
00063                                             <span class="comment">// destructor but use</span>
00064                                             <span class="comment">// explicit unlock for</span>
00065                                             <span class="comment">// clarity.</span>
00066 }
00067 
00068 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00069"></a><a class="code" href="classTSQueue.html#a3">00069</a> <span class="keyword">inline</span> T <a class="code" href="classTSQueue.html#a3">TSQueue&lt;T&gt;::dequeue</a>()
00070 {
00071      boost::mutex::scoped_lock lk(<a class="code" href="classTSQueue.html#r0">mLock</a>);   <span class="comment">// Lock</span>
00072 
00073      <span class="keywordflow">if</span> (<a class="code" href="classTSQueue.html#r2">mQ</a>.empty()) {                      <span class="comment">// If the queue is empty...</span>
00074           <a class="code" href="classTSQueue.html#r1">mEmpty</a>.wait(lk);                  <span class="comment">// ...block and wait</span>
00075      }
00076      <span class="comment">// Read, remove, unlock and return</span>
00077      T t = <a class="code" href="classTSQueue.html#r2">mQ</a>.front();
00078      <a class="code" href="classTSQueue.html#r2">mQ</a>.pop();
00079      lk.unlock();                           <span class="comment">// Unlock by lk's</span>
00080                                             <span class="comment">// destructor but use</span>
00081                                             <span class="comment">// explicit unlock for</span>
00082                                             <span class="comment">// clarity.</span>
00083      <span class="keywordflow">return</span> t;
00084 }
00085 
00086 <span class="preprocessor">#endif   // _TSQUEUE_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jan 31 14:27:33 2007 for Approxsim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
